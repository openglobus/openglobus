<html>

<head>
    <title>Simple Renderer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../lib/@openglobus/og.css" type="text/css"/>
</head>

<body>

<div style="width:100%;height:100%">
    <canvas id="frame" style="width:100%;height:100%"/>
</div>

<script type="module" id="og-sandbox-script">

    import {
        control,
        Entity,
        Object3d,
        RenderNode,
        Renderer,
        EntityCollection,
        scene,
        Vec3
    } from "../../lib/@openglobus/og.esm.js";

    let renderer = new Renderer("frame", {

        controls: [new control.SimpleNavigation({speed: 0.01}), new control.GeoObjectEditor()],
        autoActivate: true
    });

    class MyScene extends RenderNode {
        constructor() {
            super("MyScene");

            this.ec = new EntityCollection({
                //scaleByDistance: [1, 1, 1],
                //useLighting: true,
                entities: []
            });
        }

        init() {

            this.ec.addTo(this);

            this.renderer.activeCamera.eye.set(0, 0, 10);
            this.renderer.activeCamera.update();
        }

        frame() {
            //this.renderer.setRelativeCenter(this.renderer.activeCamera.eye);
        }
    }

    let myScene = new MyScene();
    renderer.addNodes([new scene.Axes(), myScene]);

    const base = Object3d.createCube(0.4, 2, 0.4).translate(new Vec3(0, 1, 0));
    const view = Object3d.createFrustum(3, 2, 1);

    //const lunar = await Object3d.loadObj('./Lunar Lander.obj');
    // let lunarParts = [];
    // for (let i = 0; i < lunar.length; i++) {
    //     lunarParts.push(new Entity({
    //         cartesian: new Vec3(0, 0, 0),
    //         geoObject: {
    //             scale: 1,
    //             instanced: true,
    //             tag: `part:${i}`,
    //             object3d: lunar[i],
    //             yaw: 0,
    //             pitch: 0,
    //             roll: 0
    //         }
    //     }));
    // }

    let parentEntity = new Entity({
        cartesian: new Vec3(0, 0, 0),
        independentPicking: true,
        geoObject: {
            scale: 1,
            instanced: true,
            tag: `base`,
            object3d: base,
            yaw: 0,
            pitch: 0,
            roll: 0
        }
    });

    let childEntity = new Entity({
        cartesian: new Vec3(0, 0, 0),
        independentPicking: true,
        relativePosition: true,
        geoObject: {
            instanced: true,
            tag: `view`,
            object3d: view,
            yaw: 0,
            pitch: 0,
            roll: 0
        }
    });

    parentEntity.appendChild(childEntity);
    myScene.ec.add(parentEntity);

    window.renderer = renderer;

    //myScene.ec.addEntities(lunarParts);

    window.parentEntity = parentEntity;
    window.childEntity = childEntity;

</script>

</body>

</html>